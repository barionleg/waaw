<!doctype html>
<html>
<head>
    <title>WebAudio Csound</title>
    <style type="text/css">
        textarea.console {
            font-family: "Courier New";
            color: #00FF99;
            background-color: #000000
        }
    </style>
    <script src='js/CsoundObj.js'></script>
    <script>
        let count = 0;
        let csoundObj;
        const TEST_CSD =
            `
  <CsoundSynthesizer>
  <CsOptions>
  </CsOptions>
  <CsInstruments>
  sr = 44100
  ksmps = 32
  nchnls = 2
  nchnls_i = 1
  0dbfs = 1

  instr 1
  ain inch 1
  al, ar reverbsc ain,ain, 0.6, 5000
    out  al, ar
  endin
  </CsInstruments>
  <CsScore>
  i1 0 36000
  </CsScore>
  </CsoundSynthesizer>
  `;
        CsoundObj.importScripts("./js/").then(() => {
                    csoundObj = new CsoundObj();
                    csoundObj.enableAudioInput((res) => {
                        if (res) {
                            csoundObj.setMessageCallback((msg) => {
                                var element = document.getElementById('console');
                                element.value += "\n" + msg;
                                element.scrollTop = 99999; // focus on bottom
                                count += 1;
                                if (count == 1000) {
                                    element.value = ' ';
                                    count = 0;
                                }
                            });
                          csoundObj.compileCSD(TEST_CSD);
                            csoundObj.start();
                        } else {
                            alert("Unable to start microphone.");
                        }
                    });
                  });
    </script>
</head>

<body>
    <H1>Reverb</H1>
    <textarea class="console" cols="65" rows="20"
    id="console" value="">Csound: loading...</textarea>
    <p>
</body>

</html>
